<html>
<head>
    <meta charset="utf-8">
    <title>.srtを作成（Facebook動画用）</title>
    <link rel='stylesheet' href='main.css?ver=1.0.0' type='text/css' media='all' />
    <script src="function.js"></script>
</head>

<body>
    <div id="banner"><span id="banner_text">.srtを作成（Facebook動画用）</span></div>
    <div><p>【仕様】<ul><li>空白があり次の発話の開始時間が先の時は1文字あたりの発話にかかる時間を平均的な直で計算します。</li>
        <li>v1のファイルは一番最後の発話終了の時間がわからないので分割処理をしません。</li>
        <li>ひとつの文字数を超えるか「。」で自動的に区切ります。</li>
        </ul>
    </div>
    <form name="openForm">
        <p>【ファイルを読み込み】</p>
        <div id="form_caption" >UDトークの会話ログ（.csv）を選択</div>
        <input id="file_select" name="csvFile" type="file" /><br />
        <input type="radio" name="version" value="0" checked>自動判別</input><br />
        <input type="radio" name="version" value="1">v1</input><br />
        <input type="radio" name="version" value="2">v2</input><br />
        <p id="detectedVersion"></p>
        <hr />
        <p>【設定】</p>
        <div id="form_caption" >1.動画の開始から最初の字幕までのオフセットを設定（ミリ秒）</div>
        <input id="offset_milliseconds" type="text" name="offsetTime" value="0" style="text-align: right;">
        <input id="update_offset_milliseconds" type="button" value="更新" name="updateOffsetMillisecondsButton">
        <div id="form_caption" >2.ひとつの文字数（半分で折り返します）</div>
        <input id="line_count" type="text" name="lineCount" value="30" style="text-align: right;">
        <input id="update_line_count" type="button" value="更新" name="updateLineCountButton">
        <div id="form_caption" >3.オプション</div>
        <input id="replacing_dots" type="checkbox" name="replacingDots" value="" style="text-align: right;" checked>「、」は半角スペースに、「。」は削除する</input><br />
        <input id="dividing" type="checkbox" name="dividing" value="" style="text-align: right;" checked>行を半分で折り返す</input>
        <hr />
        <div id="form_caption" >【変換結果を表示】</div>
        <textarea id="convert_result" name="output" cols="200" rows="40"></textarea><br />
    </form>
    
    <hr />
    <p id="footer">CC BY Shamrock Records, Inc.</p>
    <script type="text/javascript" src="tiny_segmenter.js" charset="UTF-8"></script>
    <script>
        var form = document.forms.openForm ;
        var lines = null ;

        form.csvFile.addEventListener('click', function(e) {
            this.value = "" ;
        }) ;

        function eventListener(e) {
            updateResult() ;
        } ;

        form.updateOffsetMillisecondsButton.addEventListener('click', eventListener) ;
        form.updateLineCountButton.addEventListener('click', eventListener) ;
        form.replacingDots.addEventListener('change', eventListener) ;
        form.dividing.addEventListener('change', eventListener) ;

        form.csvFile.addEventListener('change', function(e) {
            form.csvFile.textContent = "" ;
            lines = null ;
            form.output.textContent = "" ;
            document.getElementById("detectedVersion").innerText = "" ;
            
            var result = e.target.files[0];
            var reader = new FileReader() ;
        
            reader.readAsText(result) ;
        
            reader.addEventListener('load', function() {
                var content = reader.result ;
                lines = convert(content) ;
            
                generateResult(function(num, tempBeginTimeF, tempEndTimeF, tempContent) {
                    return num.toString() + '\n' + tempBeginTimeF + ' --> ' + tempEndTimeF + '\n' + tempContent + '\n\n' ;
                }) ;
            }) ;
        })

        function updateResult() {
            if (lines != null) {
                generateResult(function(num, tempBeginTimeF, tempEndTimeF, tempContent) {
                    return num.toString() + '\n' + tempBeginTimeF + ' --> ' + tempEndTimeF + '\n' + tempContent + '\n\n' ;
                }) ;
            }
        }
    </script>
</body>
</html>